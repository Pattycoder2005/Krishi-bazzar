<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Buy Products</title>
  <link rel="stylesheet" href="style.css">
  
  <style>
    .container { max-width:1100px; margin:1.5rem auto; padding:1rem; }
    .grid { display:grid; grid-template-columns: repeat(auto-fit,minmax(260px,1fr)); gap:1rem; }
    .card { background:white; padding:1rem; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.05); }
    .price { font-weight:700; color:#0b7b3b; }
    .buy-btn { background:#0b7b3b; color:white; padding:.5rem .8rem; border:0; border-radius:6px; cursor:pointer; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Available Products</h1>
    <div id="grid" class="grid">Loading‚Ä¶</div>
    <p><a href="buyer-dashboard.html">Back to Dashboard</a></p>
  </div>

  <script>
  async function load() {
    const res = await fetch('/api/products');
    const products = await res.json();
    const grid = document.getElementById('grid');
    grid.innerHTML = '';

    if (!products.length) {
      grid.innerHTML = '<p>No products yet.</p>';
      return;
    }

    products.forEach(p => {
      const div = document.createElement('div');
      div.className = 'card';
      div.innerHTML = `
        <h3>${p.name}</h3>
        <p>${p.desc || ''}</p>
        <p class="price">‚Çπ ${p.price}</p>
        <p class="muted">Seller: ${p.sellerEmail}</p>
        <button class="buy-btn" 
                data-seller="${p.sellerEmail}" 
                data-name="${p.name}" 
                data-price="${p.price}">
          Buy Now
        </button>
      `;
      grid.appendChild(div);
    });

    // üõí Handle Buy button click
    document.querySelectorAll('button.buy-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const loggedInUser = JSON.parse(localStorage.getItem("loggedInUser"));
        if (!loggedInUser) {
          alert("‚ö†Ô∏è Please log in first!");
          return;
        }

        // Save product info for checkout
        const product = {
          name: btn.dataset.name,
          price: btn.dataset.price,
          sellerEmail: btn.dataset.seller
        };
        localStorage.setItem("selectedProduct", JSON.stringify(product));

        // Redirect to checkout page (like Flipkart)
        window.location.href = "checkout.html";
      });
    });
  }

  load();
  </script>
</body>
</html>
